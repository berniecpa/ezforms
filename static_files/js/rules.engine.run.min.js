$(document).ready(function(){String.prototype.format||(String.prototype.format=function(){"use strict";var t=this.toString();if(arguments.length){var e,i=typeof arguments[0],n="string"===i||"number"===i?Array.prototype.slice.call(arguments):arguments[0];for(e in n)t=(t=t.replace(new RegExp("\\{\\{"+e+"\\}\\}","gi"),n[e])).replace(new RegExp("\\{\\{ "+e+" \\}\\}","gi"),n[e]);t=t.replace(new RegExp("{{([a-zA-Z0-9_]+)}}","gi"),"")}return t});var t=function(t){return $(t)},e=function(t){var e;if(t){var i=t.split("_",1).shift();e="checkbox"===i?$("input[name*='"+t+"[]']"):"radio"===i?$("input[name*='"+t+"']"):"matrix"===i?$("#"+t).find("input"):$("#"+t)}return e},i=function(t){var e,i;if(t instanceof Array){var n,a=[];for(n=0;n<t.length;n++){var r;if("radio"===(i=t[n].split("_",1).shift()))r="input[name='"+t[n]+"']:checked";else if("checkbox"===i)r="input[name*='"+t[n]+"[]']:checked";else if("matrix"===i){r="radio"===(o=$("#"+t[n])).attr("data-matrix-type")?"#"+t[n]+" input[type='radio']:checked":"checkbox"===o.attr("data-matrix-type")?"#"+t[n]+" input[type='checkbox']:checked":"#"+t[n]+" :input"}else r="#"+t[n];a.push(r)}e=$(a.join(", "))}else if("radio"===(i=t.split("_",1).shift()))e=$("input[name='"+t+"']:checked");else if("checkbox"===i)e=$("input[name*='"+t+"[]']:checked");else if("matrix"===i){var o;e="radio"===(o=$("#"+t)).attr("data-matrix-type")?o.find("input[type='radio']:checked"):"checkbox"===o.attr("data-matrix-type")?o.find("input[type='checkbox']:checked"):o.find(":input")}else e=$("#"+t);return e},n=function(e){return"field"===e.find("original")?i(e.find("original","originalField")):t(e.find("original","originalElement"))},a=function(i,n){if("field"===i.find("target"))e(i.find("target","targetField")).val(n);else if("element"===i.find("target")){var a=t(i.find("target","targetElement"));a.length>1?$.each(a,function(){$(this).is(":input")?$(this).val(n):$(this).text(n)}):a.is(":input")?a.val(n):a.text(n)}},r=function(){var r={},s=$("body"),f=s.outerHeight(!0);$.each(options.fieldIds,function(t,e){var i=$("#"+e),n=i.attr("name"),a=i.attr("type")||i.get(0).tagName.toLowerCase();"checkbox"===a?r[e]=i.is(":checked"):"radio"===a?r[n]=$("input[name='"+n+"']:checked").val():r[e]="button"===a?i.data("clicked"):i.val()});var l={toShow:function(i){if("field"===i.find("target")){var n=e(i.find("target","targetField"));n.is(":visible")||n.trigger("ef.show"),n.is(":radio, :checkbox")?n.css("display","inline-block"):n.show(),n.parent().closest("div.form-group").show(),n.trigger("ef.shown")}else if("element"===i.find("target")){var a=t(i.find("target","targetElement"));a.is(":visible")||a.trigger("ef.show"),a.show().trigger("ef.shown")}},toHide:function(i){if("field"===i.find("target")){var n=e(i.find("target","targetField"));n.is(":visible")&&n.trigger("ef.hide"),n.hide(),n.parent().closest("div.form-group").hide(),n.trigger("ef.hidden")}else if("element"===i.find("target")){var a=t(i.find("target","targetElement"));a.is(":visible")&&a.trigger("ef.hide"),a.hide().trigger("ef.hidden")}},toEnable:function(i){if("field"===i.find("target"))e(i.find("target","targetField")).prop("disabled",!1);else"element"===i.find("target")&&t(i.find("target","targetElement")).prop("disabled",!1)},toDisable:function(i){if("field"===i.find("target"))e(i.find("target","targetField")).prop("disabled",!0);else"element"===i.find("target")&&t(i.find("target","targetElement")).prop("disabled",!0)},performArithmeticOperations:function(t){!function(t){var e=t.find("operator"),n=t.find("operands"),r=NaN;e&&($.isArray(n)&&$.each(n,function(t,n){var a=i(n);if(a.length>1)$.each(a,function(t,i){var n=parseFloat($(i).val());if(!isNaN(n))if(isNaN(r))r=n;else switch(e){case"+":r+=n;break;case"-":r-=n;break;case"*":r*=n;break;case"/":r/=n;break;case"%":r%=n}});else if(1===a.length){var o=parseFloat(a.val());if(!isNaN(o))if(isNaN(r))r=o;else switch(e){case"+":r+=o;break;case"-":r-=o;break;case"*":r*=o;break;case"/":r/=o;break;case"%":r%=o}}}),isNaN(r)&&(r=0),a(t,r))}(t)},evaluateMathFormula:function(t){!function(t){var e=t.find("formula"),i="",n="",a=/\{\{([a-zA-Z_0-9]+)\}\}/gm;a.test(e)&&(e=e.replace(a,"{{#$1}}")),"field"===t.find("target")?(n=t.find("target","targetField")).length>0&&e.length&&(i="{{#"+n+"}} = "+e):"element"===t.find("target")&&(n=t.find("target","targetElement")).length>0&&e.length&&(i="{{"+n+"}} = "+e),i.length>0&&$("form").evaluate(i)}(t)},resetResult:function(t){if(options.submitted)return!1;a(t,0)},copy:function(i){!function(i,n){var a="field"===i.find("target")?e(i.find("target","targetField")):t(i.find("target","targetElement")),r=n.is(":input")?n.val():n.html();n.length>1&&(r=n.map(function(){return $(this).is(":input")?$(this).val():$(this).text()}).get().filter(Boolean).join(", ")),"value"===i.find("original")&&(r=i.find("original","originalValue")),a.length>1?a.is(":radio, :checkbox")?n.length>1?($(":checkbox[name*='"+a.attr("name")+"']").prop("checked",!1),$.each(n,function(){$(this).is(":checkbox")&&(r=$(this).val(),$(":checkbox[name*='"+a.attr("name")+"'][value*='"+r+"']").prop("checked",!0))})):($(":input[name*='"+a.attr("name")+"']").prop("checked",!1),$(":input[name*='"+a.attr("name")+"'][value*='"+r+"']").prop("checked",!0)):a.is(":input")?a.val(r):a.text(r):a.is(":radio, :checkbox")?($(":input[name*='"+a.attr("name")+"']").prop("checked",!1),$(":input[name*='"+a.attr("name")+"'][value*='"+r+"']").prop("checked",!0)):a.is(":input")?a.val(r):a.html(r)}(i,n(i))},skip:function(t,e){0===$.grep(options.skips,function(t){return t.id===e}).length&&options.skips.push({id:e,from:null,to:parseInt(t.find("step"))})},resetSkip:function(t,e){options.skips=$.grep(options.skips,function(t){return t.id!==e})},formatNumber:function(i){if(options.twoLetterLanguageCode&&numeral.locale(options.twoLetterLanguageCode),"field"===i.find("target")){var n=e(i.find("target","targetField"));if(n){var a=numeral(parseFloat(n.val())).format(i.find("format"));n.val(a)}}else if("element"===i.find("target")){var r=t(i.find("target","targetElement"));if(r){var o=numeral(parseFloat(r.text())).format(i.find("format"));r.text(o)}}},formatText:function(i){!function(i,n){var a="field"===i.find("target")?e(i.find("target","targetField")):t(i.find("target","targetElement")),r={};n.map(function(t){r[t]=$(this).is(":input")?$(this).val():$(this).text();var e=$(this).attr("id");$(this).is(":radio")?e=$(this).attr("name"):$(this).is(":checkbox")&&(e=$(this).attr("name").replace("[]","")),e.length>1&&(r[e]=$(this).is(":input")?$(this).val():$(this).text(),$(this).is(":checkbox")&&(r[e]=$(":input[name*='"+$(this).attr("name")+"']:checked").map(function(){return $(this).is(":input")?$(this).val():$(this).text()}).get().filter(Boolean).join(", ")));var i=$(this).data("alias"),n=$(this).data("matrix-id");if(i&&i.length>1){if(n&&n.length>1){var a=i.split("_");a.length>1&&(i=a[0]+"_"+a[1])}r[i]=r[e]}});var o=i.find("format").format(r);a.is(":radio, :checkbox")||(a.is(":input")?a.val(o):a.html(o))}(i,n(i))},form:function(t){var e=t.find("action");"submit"===e?(console.trace("SUBMIT"),o.submit()):"reset"===e?o.get(0).reset():"nextStep"===e?nextStep():"previousStep"===e&&previousStep()}};$.each(options.rules,function(t,e){var i=new RuleEngine({conditions:JSON.parse(e.conditions),actions:JSON.parse(e.actions)}),n=e.opposite?{toShow:"toHide",toHide:"toShow",toEnable:"toDisable",toDisable:"toEnable",performArithmeticOperations:"resetResult",skip:"resetSkip"}:{};i.run(r,l,n)});var c=s.outerHeight(!0);f!==c&&Utils.postMessage({height:c})},o=$("form");o.find(":input:not(select)").on("input click",function(){r()}),o.find("select").on("change",function(){r()}),o.on("view success",function(){r()}),o.find(":button").mousedown(function(){$(this).data("clicked",!0)})});