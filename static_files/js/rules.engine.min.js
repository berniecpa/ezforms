var global=this;(function(){var f={isPresent:function(k,j){return !!k},isBlank:function(k,j){return !k},equalTo:function(l,k){var j=c(l,k);return""+j.actual===""+j.target},notEqualTo:function(k,j){return""+k!==""+j},greaterThan:function(k,j){return parseFloat(k)>parseFloat(j)},greaterThanEqual:function(k,j){return parseFloat(k)>=parseFloat(j)},lessThan:function(k,j){return parseFloat(k)<parseFloat(j)},lessThanEqual:function(k,j){return parseFloat(k)<=parseFloat(j)},isIn:function(m,l){var k=l.split("|");if(k.length>0){for(var j=0;j<k.length;j++){if(m&&m.indexOf(k[j])>-1){return true}}}return m&&m.indexOf(l)>-1},isNotIn:function(m,l){var k=l.split("|");if(k.length>0){for(var j=0;j<k.length;j++){if(m&&m.indexOf(k[j])===-1){return true}}}return m&&m.indexOf(l)===-1},startsWith:function(k,j){return k&&k.indexOf(j)===0},endsWith:function(k,j){return k&&k.indexOf(j,k.length-j.length)!==-1},isBefore:function(l,k){var j=c(l,k);return new Date(j.actual).getTime()<new Date(j.target).getTime()},isAfter:function(l,k){var j=c(l,k);return new Date(j.actual).getTime()>new Date(j.target).getTime()},isChecked:function(k,j){return !!k},isNotChecked:function(k,j){return !k},hasFileSelected:function(k,j){return !!k},hasNoFileSelected:function(k,j){return !k},hasBeenClicked:function(k,j){return !!k},hasBeenSubmitted:function(k,j){return options.submitted}};var e=global.RuleEngine=function e(j){j=j||{};this.id=Utils.hashCode(JSON.stringify(j.conditions));this.operators={};this.actions=j.actions||[];this.conditions=j.conditions||{all:[]};this.addOperators(f)};e.prototype={run:function(k,p,n,j){var m,l,o=this;this.matches(k,function(r,q){m=q;l=r;if(q&&!r){o.runActions(p)}else{if(!q&&!r&&options.runOppositeActions){o.runOppositeActions(n,p)}}if(j){j(r,q)}});if(l){throw l}return m},matches:function(k,j){var l,m;a(this.conditions,k,this,function(o,n){if(o){m=o;console.log("ERR",o.message,o.stack)}l=n;if(j){j(o,n)}});if(m){throw m}if(!j){return l}},operator:function(j){return this.operators[j]},addOperators:function(k){var l=this;for(var j in k){if(k.hasOwnProperty(j)){(function(){var m=k[j];if(m.length==2){l.operators[j]=function(r,q,o){try{var n=m(r,q);o(null,n)}catch(p){o(p)}}}else{if(m.length==3){l.operators[j]=m}else{throw"Operators should have an arity of 2 or 3; "+j+" has "+m.length}}})()}}},runActions:function(n){for(var l=0;l<this.actions.length;l++){var m=this.actions[l];var k=m.value;var j=n[k];if(j){j(new b(m),this.id)}}},runOppositeActions:function(n,o){for(var l=0;l<this.actions.length;l++){var m=this.actions[l];var k=n[m.value];var j=o[k];if(j){j(new b(m),this.id)}}}};function b(j){this.data=j}b.prototype={find:function(){var l=this.data;for(var k=0;k<arguments.length;k++){var j=arguments[k];l=g(j,l);if(!l){return null}}return l.value}};function g(k,m){var j=m.fields||[];for(var l=0;l<j.length;l++){var n=j[l];if(n.name===k){return n}}return null}function a(l,m,k,j){if(l.all||l.any||l.none){d(l,m,k,j)}else{h(l,m,k,j)}}function d(l,q,u,m){try{var v=!!l.all;var s=!!l.any;var n=!!l.none;var j=v?l.all:l.any;if(n){j=l.none}if(j.length==0){return m(null,true)}var k,p=0;var r=function(){try{k=j[p];p++;if(k){a(k,q,u,o)}else{var w=n?true:v;m(null,w)}}catch(x){m(x)}};var o=function(x,w){if(x){return m(x)}if(v&&!w){return m(null,false)}if(s&&!!w){return m(null,true)}if(n&&!!w){return m(null,false)}r()};r()}catch(t){m(t)}}function h(l,o,k,j){try{var m=o[l.name];if(m&&m.call){if(m.length===1){return m(function(p){i(p,l.operator,l.value,k,j)})}else{m=m()}}i(m,l.operator,l.value,k,j)}catch(n){j(n)}}function i(p,k,n,l,j){try{var m=l.operator(k);if(!m){throw"Missing "+k+" operator"}m(p,n,j)}catch(o){j(o)}}function c(p,n){var l=n.match(/{(.*?)(?::(.+?))?}/);if(l&&typeof l[1]!=="undefined"&&p&&p.length){var u=l[1].toLowerCase();var k=typeof l[2]!=="undefined"?parseInt(l[2],10):null;switch(u){case"today":var s=new Date();if(k){s.setDate(s.getDate()+k)}var r=s.getFullYear();var q=("0"+(s.getMonth()+1)).slice(-2);var m=("0"+s.getDate()).slice(-2);n=r+"-"+q+"-"+m;p=p.substring(0,10);break;case"monday":case"tuesday":case"wednesday":case"thursday":case"friday":case"saturday":case"sunday":var o=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"];var j=new Date(p);if(p.length===10){j=new Date(p.replace(/-/g,"/"))}p=!j||isNaN(j.getDay())?"":j.getDay();n=o.indexOf(u);break}}return{actual:p,target:n}}if(typeof module!=="undefined"){module.exports=e;delete global.RuleEngine}})();